<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="keywords" content="Learn how to use Opis Database ORM">
<title>Basic operations | Opis Database</title>
    <link href="/assets/img/favicon.png" rel="shortcut icon">
<link rel="stylesheet" href="/assets/css/flatly-theme.min.css">
<link href="/assets/css/font-awesome.css" rel="stylesheet">
<link href="/assets/css/syntax.css" rel="stylesheet">
<link href="/assets/css/prism-github.css" rel="stylesheet">
<link href="/assets/css/project.css" rel="stylesheet">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/github-fork-ribbon-css/0.1.1/gh-fork-ribbon.min.css" />
    <!--[if lt IE 9]>
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/github-fork-ribbon-css/0.1.1/gh-fork-ribbon.ie.min.css" />
    <![endif]-->
    <!--[if lt IE 9]>
<script src="/assets/js/html5shiv.js"></script>
<script src="/assets/js/respond.min.js"></script>
<![endif]-->
<!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
<script src="/assets/js/jquery-1.11.0.min.js"></script>
<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="/assets/js/bootstrap.min.js"></script>
<script src="/assets/js/prism.js"></script>
</head>
<body>
    <div class="github-fork-ribbon-wrapper right hidden-sm hidden-xs">
        <div class="github-fork-ribbon" style="background-color: #f80">
            <a href="https://github.com/opis/database">Fork me on GitHub</a>
        </div>
    </div>
    <header id="header" class="navbar navbar-default navbar-static-top">
        <div class="container">
            <div class="navbar-header">
                <img src="/assets/img/opis-gs-100.png" class="img-responsive opis-inline-logo">
                <a href="/database/3.6" class="navbar-brand">
                    <strong>
                        Database
                    </strong>
                </a>
                <button data-target="#navbar-main" data-toggle="collapse" type="button" class="navbar-toggle">
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
            </div>
            <nav id="navbar-main" class="collapse navbar-collapse navbar-right">
                <ul class="nav navbar-nav">
                    <li>
                        <a href="/" title="Main page">
                            <span class="fa fa-home"></span> Home
                        </a>
                    </li>
                    <li class="dropdown hidden-md hidden-lg">
    <a class="dropdown-toggle" data-toggle="dropdown" href="#">
        <span class="fa fa-file-text"></span> Documentation <span class="caret"></span>
    </a>
    <ul class="dropdown-menu">
            <li class="dropdown-header">Getting started</li>
            <li><a href="/database/3.6/index" title="Getting started with Opis Database">About</a></li>
            <li><a href="/database/3.6/connections" title="Learn how to connect to a database">Database connections</a></li>
            <li class="dropdown-header">The basics</li>
            <li><a href="/database/3.6/fetching-records" title="Fetching records from a database">Fetching records</a></li>
            <li><a href="/database/3.6/results-handling" title="Learn how to handle the result set of a query">Results handling</a></li>
            <li><a href="/database/3.6/aggregate-functions" title="Learn about aggregate functions">Aggregate functions</a></li>
            <li><a href="/database/3.6/extended-selections" title="Learn about how to define custom selections">Extended selections</a></li>
            <li><a href="/database/3.6/filters" title="Learn how to filter records">Filter</a></li>
            <li><a href="/database/3.6/expressions" title="Learn about expressions">Expressions</a></li>
            <li><a href="/database/3.6/ordering-criteria" title="Learn how to order results">Ordering criteria</a></li>
            <li><a href="/database/3.6/limits-and-offsets" title="Learn about limits and offsets">Limits and offset</a></li>
            <li><a href="/database/3.6/joins" title="Learn how to perform joins">Joins</a></li>
            <li><a href="/database/3.6/aggregates-handling" title="Learn how to work with aggregates">Working with aggregates</a></li>
            <li><a href="/database/3.6/insert-records" title="Insert new records into a table">Insert records</a></li>
            <li><a href="/database/3.6/update-records" title="Learn how to update existing records">Update records</a></li>
            <li><a href="/database/3.6/delete-records" title="Learn how to delete existing records">Delete records</a></li>
            <li class="dropdown-header">Transactions</li>
            <li><a href="/database/3.6/transactions" title="Learn how to use transactions">Performing transactions</a></li>
            <li class="dropdown-header">Database schema</li>
            <li><a href="/database/3.6/schema" title="Learn about Opis Database schema">Introduction</a></li>
            <li><a href="/database/3.6/schema-creating-tables" title="Learn how to create new tables">Creating tables</a></li>
            <li><a href="/database/3.6/schema-modifying-tables" title="Learn how to alter existing new tables">Modifying tables</a></li>
            <li class="dropdown-header">ORM</li>
            <li><a href="/database/3.6/orm" title="Learn about Opis Database ORM">Introduction</a></li>
            <li class="active"><a href="/database/3.6/orm-basics" title="Learn how to use Opis Database ORM">Basic operations</a></li>
            <li><a href="/database/3.6/orm-relationships" title="Learn about ORM relationships">Relationships</a></li>
            <li><a href="/database/3.6/orm-models" title="Learn how to work with models">Working with models</a></li>
    </ul>
</li>
                    <li class="dropdown">
                        <a class="dropdown-toggle" data-toggle="dropdown" href="#">
                            <span class="fa fa-cogs"></span> Components <span class="caret"></span>
                        </a>
                        <ul class="dropdown-menu">
                            <li><a href="/cache/3.1">Cache</a></li>
                            <li><a href="/closure/2.3">Closure</a></li>
                            <li><a href="/config/2.1">Config</a></li>
                            <li><a href="/container/2.3">Container</a></li>
                            <li><a href="/database/3.6">Database</a></li>
                            <li><a href="/events/4.1">Events</a></li>
                            <li><a href="/http/2.0">HTTP</a></li>
                            <li><a href="/http-routing/4.0">HTTP Routing</a></li>
                            <li><a href="/routing/4.1">Routing</a></li>
                            <li><a href="/session/3.1">Session</a></li>
                            <li><a href="/view/4.1">View</a></li>
                        </ul>
                    </li>
                    <li class="hidden-md hidden-lg">
                        <a href="https://github.com/opis/database" title="Github page">
                            <span class="fa fa-github fa-lg"></span> GitHub
                        </a>
                    </li>
                </ul>
            </nav>
        </div>
    </header>
    <section>
        <div class="container">
            <div class="row">
                <div class="col-md-4 hidden-xs hidden-sm">
<ul class="navigation">
            <li class="chapter">Getting started</li>
            <ul>
                <li><a href="/database/3.6/index" title="Getting started with Opis Database">About</a></li>
            <li><a href="/database/3.6/connections" title="Learn how to connect to a database">Database connections</a></li>
                </ul>
            <li class="chapter">The basics</li>
            <ul>
                <li><a href="/database/3.6/fetching-records" title="Fetching records from a database">Fetching records</a></li>
            <li><a href="/database/3.6/results-handling" title="Learn how to handle the result set of a query">Results handling</a></li>
            <li><a href="/database/3.6/aggregate-functions" title="Learn about aggregate functions">Aggregate functions</a></li>
            <li><a href="/database/3.6/extended-selections" title="Learn about how to define custom selections">Extended selections</a></li>
            <li><a href="/database/3.6/filters" title="Learn how to filter records">Filter</a></li>
            <li><a href="/database/3.6/expressions" title="Learn about expressions">Expressions</a></li>
            <li><a href="/database/3.6/ordering-criteria" title="Learn how to order results">Ordering criteria</a></li>
            <li><a href="/database/3.6/limits-and-offsets" title="Learn about limits and offsets">Limits and offset</a></li>
            <li><a href="/database/3.6/joins" title="Learn how to perform joins">Joins</a></li>
            <li><a href="/database/3.6/aggregates-handling" title="Learn how to work with aggregates">Working with aggregates</a></li>
            <li><a href="/database/3.6/insert-records" title="Insert new records into a table">Insert records</a></li>
            <li><a href="/database/3.6/update-records" title="Learn how to update existing records">Update records</a></li>
            <li><a href="/database/3.6/delete-records" title="Learn how to delete existing records">Delete records</a></li>
                </ul>
            <li class="chapter">Transactions</li>
            <ul>
                <li><a href="/database/3.6/transactions" title="Learn how to use transactions">Performing transactions</a></li>
                </ul>
            <li class="chapter">Database schema</li>
            <ul>
                <li><a href="/database/3.6/schema" title="Learn about Opis Database schema">Introduction</a></li>
            <li><a href="/database/3.6/schema-creating-tables" title="Learn how to create new tables">Creating tables</a></li>
            <li><a href="/database/3.6/schema-modifying-tables" title="Learn how to alter existing new tables">Modifying tables</a></li>
                </ul>
            <li class="chapter">ORM</li>
            <ul>
                <li><a href="/database/3.6/orm" title="Learn about Opis Database ORM">Introduction</a></li>
            <li class="active"><a href="/database/3.6/orm-basics" title="Learn how to use Opis Database ORM">Basic operations</a></li>
            <li><a href="/database/3.6/orm-relationships" title="Learn about ORM relationships">Relationships</a></li>
            <li><a href="/database/3.6/orm-models" title="Learn how to work with models">Working with models</a></li>
    </ul>
</ul>
                </div>
                <div class="col-md-8 col-sm-12">
                    <h1 id="basic-operations">Basic operations</h1>
<ol>
  <li><a href="#finding-records-by-primary-key">Finding records by primary key</a></li>
  <li><a href="#accessing-column-values">Accessing column values</a></li>
  <li><a href="#performing-queries">Performing queries</a></li>
  <li><a href="#inserting-records">Inserting records</a></li>
  <li><a href="#updating-records">Updating records</a></li>
  <li><a href="#mass-assignment">Mass assignment</a></li>
  <li><a href="#deleting-records">Deleting records</a></li>
</ol>
<h2 id="finding-records-by-primary-key">Finding records by primary key</h2>
<p>Finding a record by its primary key is done by using the <code>find</code> method. 
This method returns <code>false</code> if no records were found.</p><pre><code class="language-php">$user = User::find(1);

if($user !== false)
{
    // do something
}
</code></pre>
<p>If you want to find multiple records by their primary key, you can use the <code>findMany</code>
method which will return an array of models, or an empty array if no records were found. 
This method takes as an argument an array containing primary key values.</p><pre><code class="language-php">$users = User::findMany([1, 2, 3]);

foreach($users as $user)
{
    // do something
}
</code></pre>
<p>You can load all records from a model’s table by using the <code>findAll</code> method.</p><pre><code class="language-php">$users = User::findAll();

foreach($users as $user)
{
    // do something
}
</code></pre>
<p>You can specify which columns to be included by passing an array of column names 
to the <code>find</code>, <code>findMany</code> or <code>findAll</code> methods.</p><pre><code class="language-php">$user = User::find(1, ['name', 'age']);

$users = User::findMany([1, 2, 3], ['name', 'age']);

$users = User::findAll(['name', 'age']);
</code></pre>
<h2 id="accessing-column-values">Accessing column values</h2>
<p>Accessing the column values of the model is done by accessing the corresponding property 
of the model instance.</p><pre><code class="language-php">foreach(User::findAll() as $user)
{
    echo $user-&gt;name, PHP_EOL;
}
</code></pre>
<p>You can alias a column’s name by setting a <code>$mapColumns</code> property on the model’s class.</p><pre><code class="language-php">class User extends BaseModel
{
    protected $mapColumns = ['registration_email' =&gt; 'registrationEmail'];
}
</code></pre>
<p>In the above example, a column named <code>registration_email</code> was mapped to <code>registrationEmail</code>. 
Now we can access the <code>registrationEmail</code> property on a model instance to retrieve 
the value of the <code>registration_email</code> column.</p><pre><code class="language-php">foreach(User::findAll() as $user)
{
    echo $user-&gt;registrationEmail, PHP_EOL;
}
</code></pre>
<h4 id="mutators">Mutators</h4>
<p>Mutators allow to intercept and change the value that is going to be set to a property of the model. 
Defining a mutator is done by creating a method that has the same name as the property, 
followed by the <code>Mutator</code> suffix.</p><pre><code class="language-php">class User extends BaseModel
{
    public function passwordMutator($value)
    {
        return password_hash($value, PASSWORD_DEFAULT);
    }
}

// ...

$user = new User;

$user-&gt;name = 'John Doe';
$user-&gt;password = $secret;

$user-&gt;save();
</code></pre>
<h4 id="accessors">Accessors</h4>
<p>Accessors allow you to intercept and modify the value returned by accessing a 
property of a model. You can define an accessor for a model’s property by adding 
a method with the same name as the property, followed by the <code>Accessor</code> suffix.</p><pre><code class="language-php">class User extends BaseModel
{
    public function registrationDateAccessor($value)
    {
        return new DateTime($value);
    }
}

// ...

$user = User::find(1);

echo $user-&gt;registrationDate-&gt;format('Y-m-d H:i:s');
</code></pre>
<h4 id="type-casting">Type casting</h4>
<p>You can cast a column’s value from one type to another by using the <code>$cast</code> property. 
The supported cast types are: <code>integer</code>, <code>float</code>, <code>string</code>, <code>boolean</code>, <code>date</code> and <code>array</code>.</p><pre><code class="language-php">class User extends BaseModel
{
    protected $cast = ['is_admin' =&gt; 'boolean'];
    
    protected $mapColumns = ['is_admin' =&gt; 'isAdmin'];
    
}

// ...

$user = User::find(1);

if($user-&gt;isAdmin)
{
    // do something
}
</code></pre>
<p>The array type cast is used to deserialize <em>JSON</em> into a <em>PHP</em> array. 
You can modify that array and set it back as property and the array will be automatically 
serialized back into <em>JSON</em>.</p><pre><code class="language-php">class Page extends BaseModel
{
    protected $cast = ['keywords' =&gt; 'array'];
    
}

// ...

$page = Page::find(1);

$keywords = $page-&gt;keywords;

if(!in_array('ORM', $keywords))
{
    $keyowrds[] = 'ORM';
}

$page-&gt;keywords = $keywords;
$page-&gt;save();
</code></pre>
<h4 id="custom-type-casting">Custom type casting</h4>
<p class="well text-primary"><strong class="important">Important!</strong>
This feature is available starting with version <code>3.3.2</code>.</p>
<p>You can define a new casting type or how a casting operation is handled by using
the <code>$castType</code> property. If your cast callback is a non-static method on the current class, 
just use as a callback the method’s name prefixed with <code>@</code>. The callback takes as arguments 
the cast’s name and the value that needs to be casted.</p><pre><code class="language-php">class User extends BaseModel
{
    protected $cast = [
        'registration_date' =&gt; 'date',
        'is_admin' =&gt; 'boolean',
    ];
    
    protected $castType = [
        'boolean' =&gt; [__CLASS__, 'castBoolean'],
        'date' =&gt; '@castDate'
    ];
    
    
    // Non-static handler
    protected function castDate($cast, $value)
    {
        // ...
    }
    
    // Static handler
    protected static function castBoolean($cast, $value)
    {
        // ...
    }
}
</code></pre>
<h2 id="performing-queries">Performing queries</h2>
<p>Since model classes are basically build over a query builder, you can use them to 
perform complex queries by adding <a href="filters" title="Filters">filters</a>, <a href="limit-and-offsets" title="Limits and offsets">limits</a>, <a href="joins" title="Joins">joins</a> or <a href="ordering-criteria" title="Ordering criteria">ordering criteria</a> to your queries. 
Retrieving the results of a query is done by using the <code>all</code> method. The method returns 
an array of models or an empty array if no records were found.</p><pre><code class="language-php">$users = User::where('age')-&gt;atLeast(18)
             -&gt;orderBy('age')
             -&gt;all();
</code></pre>
<p>Retrieving only the first result of a query is done by using the <code>first</code> method. 
This method returns <code>false</code> if no records were found.</p><pre><code class="language-php">$user = User::where('age')-&gt;atLeast(18)
            -&gt;orderBy('age')
            -&gt;limit(1)
            -&gt;first();
</code></pre>
<h4 id="query-scopes">Query scopes</h4>
<p>Scopes allow you to define sets of constraints that you can utilize by calling a single method.
Defining a scope is simply a matter of adding a method that contains the <code>Scope</code> suffix. 
Scopes must always return an instance of the query builder.</p><pre><code class="language-php">class User extends BaseModel
{
    public function fullAgedScope($query)
    {
        return $query-&gt;where('age')-&gt;atLeast(18);
    }
}
</code></pre>
<p>To use the newly created scope simply make a call that utilizes the scope method’s 
name without the <code>Scope</code> suffix.</p><pre><code class="language-php">// Return a list of full-aged users
$users = User::fullAged()
             -&gt;orderBy('name')
             -&gt;all();
</code></pre>
<h4 id="joins">Joins</h4>
<p class="well text-primary"><strong class="important">Important!</strong>
All records returned by a query that uses <code>joins</code> 
will be marked as <a href="#read-only-records">read-only records</a>.</p>
<p>A possible use case for joins is when you want, for example, to return a list with 
all users that have written at least one article.</p><pre><code class="language-php">$users = User::join('articles', function($join){
                $join-&gt;on('users.id', 'articles.user_id');
             })
             -&gt;all();
</code></pre>
<p>The above example will return duplicates if a user have written multiple articles. 
This can be solved by selecting only the distinct users with the help of the <code>distinct</code> method.</p><pre><code class="language-php">$users = User::join('articles', function($join){
                $join-&gt;on('users.id', 'articles.user_id');
             })
             -&gt;distinct()
             -&gt;all();
</code></pre>
<h4 id="single-column-s-value">Single column’s value</h4>
<p>Retrieving a single column’s value is done by using the <code>column</code> method. 
The method returns the scalar value of the column or <code>false</code> if no records were found.</p><pre><code class="language-php">$name = User::where('id')-&gt;is(1)-&gt;column('name');
</code></pre>
<h4 id="aggregates">Aggregates</h4>
<p>You can also use all the <a href="aggregates">aggregates</a> functions. 
These methods return scalar values.</p><pre><code class="language-php">$count = User::count();

$max = User::max('age');

$avg = User::avg('age');
</code></pre>
<h2 id="inserting-records">Inserting records</h2>
<p>Inserting new records is done by creating a new instance of a model, setting the desired attributes
on the model’s instance and then calling the model’s <code>save</code> method.</p><pre><code class="language-php">$user = new User;

$user-&gt;name = 'John Doe';
$user-&gt;email = 'foo@example.com';
$user-&gt;age = 18;

$user-&gt;save();
</code></pre>
<h2 id="updating-records">Updating records</h2>
<p>Updating a model consists in retrieving the model, setting the properties you want to update,
and finally calling the <code>save</code> method.</p><pre><code class="language-php">$user = User::find(1);

$user-&gt;email = 'bar@example.com';

$user-&gt;save();
</code></pre>
<p>You can also update models that match a given query by using the <code>update</code> method.</p><pre><code class="language-php">User::where('id')-&gt;is(1)
    -&gt;update(['is_active' =&gt; true]);
</code></pre>
<h4 id="read-only-records">Read-only records</h4>
<p>By default, the models retrieved using join clauses are marked as <em>read-only</em>. 
Trying to save or to update a <em>read-only</em> model will result into an exception being thrown. 
A model can also be explicitly marked as being <em>read-only</em> by setting the model’s 
<code>$readonly</code> property to true.</p><pre><code class="language-php">class Comment extends BaseModel
{
    protectd $readonly = true;
}
</code></pre>
<h2 id="mass-assignment">Mass assignment</h2>
<p>Another way of creating or updating models is through mass assignment. 
Creating a model through mass assignment is done by using the <code>create</code> method. 
The method returns the instance of the inserted model.</p><pre><code class="language-php">$user = User::create(['name' =&gt; 'John Doe',
                      'email' =&gt; 'foo@example.com',
                      'age' =&gt; 18]);
</code></pre>
<p>Updating an existing model is done by using the <code>assign</code> method on the model’s instance.</p><pre><code class="language-php">$user = User::find(1);

$user-&gt;assign(['email' =&gt; 'bar@example.com']);

$user-&gt;save();
</code></pre>
<h4 id="fillable-attributes">Fillable attributes</h4>
<p>You can define which properties of the model can be set through mass assignment 
by using the <code>$fillable</code> property. The property must contain an array with all 
the column names that can receive values through mass assignment.</p><pre><code class="language-php">class User extends BaseModel
{
    protected $fillable = ['name', 'email', 'age'];
}
</code></pre>
<h4 id="guarded-attributes">Guarded attributes</h4>
<p>Defining which properties of a model are not fillable is done by using the <code>$guarded</code> property.
The property must contain an array with all the column names that can not receive 
values through mass assignment.</p>
<p class="well text-primary"><strong class="important">Important!</strong>
The <code>$guarded</code> attributes serve as a <em>black list</em> while 
the <code>$fillable</code> attributes serve as a <em>white list</em>. You should only use one of this two, not both.</p><pre><code class="language-php">class User extends BaseModel
{
    protected $guarded = ['id', 'is_active', 'is_admin'];
}
</code></pre>
<h2 id="deleting-records">Deleting records</h2>
<p>Deleting a record form the database can be done by calling the <code>delete</code> method on a model’s instance.</p><pre><code class="language-php">$user = User::find(1);

$user-&gt;delete();
</code></pre>
<p>You can also use a query if you want to select a set of models that needs to be deleted.</p><pre><code class="language-php">User::where('age')-&gt;lessThan(18)
    -&gt;delete();
</code></pre>
<ul class="pager">
        <li class="previous"><a href="/database/3.6/orm" title="Introduction">&larr; Back</a></li>
        <li class="next"><a href="/database/3.6/orm-relationships" title="Relationships">Next &rarr;</a></li>
</ul>
                </div>
            </div>
        </div>
    </section>
    <a href="#0" id="back-to-top">
    <span class="fa fa-arrow-up"></span>
</a>
<script>
    (function($){
        $(document).ready(function(){
            var visible = false;
            $(window).scroll(function(){
                var top = $(this).scrollTop();
                if (top >= 100 && !visible) {
                    visible = true;
                    $('#back-to-top').fadeIn().show();
                }
                if(top < 100 && visible){
                    visible = false;
                    $('#back-to-top').fadeOut();
                }
            });
            $('#back-to-top').click(function(){
                $('html, body').animate({scrollTop : 0},800);
                return false;
            });
        });
        $('h2[id],h3[id],h4[id],h5[id],h6[id]').each(function () {
            var child = $('<a href="#' + this.getAttribute('id') + '" class="link-anchor"><span class="fa fa-link"></span></a>');
            this.appendChild(child.get(0));
        });
        $('[data-toggle=tooltip]').tooltip();
    })(jQuery);
</script>
    <footer class="text-center text-muted">
        Copyright &copy; 2014-2016 The Opis Project. All rights reserved.
    </footer>
</body>
</html>
