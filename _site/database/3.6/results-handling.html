<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="keywords" content="Learn how to handle the result set of a query">
<title>Results handling | Opis Database</title>
    <link href="/assets/img/favicon.png" rel="shortcut icon">
<link rel="stylesheet" href="/assets/css/flatly-theme.min.css">
<link href="/assets/css/font-awesome.css" rel="stylesheet">
<link href="/assets/css/syntax.css" rel="stylesheet">
<link href="/assets/css/prism-github.css" rel="stylesheet">
<link href="/assets/css/project.css" rel="stylesheet">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/github-fork-ribbon-css/0.1.1/gh-fork-ribbon.min.css" />
    <!--[if lt IE 9]>
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/github-fork-ribbon-css/0.1.1/gh-fork-ribbon.ie.min.css" />
    <![endif]-->
    <!--[if lt IE 9]>
<script src="/assets/js/html5shiv.js"></script>
<script src="/assets/js/respond.min.js"></script>
<![endif]-->
<!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
<script src="/assets/js/jquery-1.11.0.min.js"></script>
<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="/assets/js/bootstrap.min.js"></script>
<script src="/assets/js/prism.js"></script>
</head>
<body>
    <div class="github-fork-ribbon-wrapper right hidden-sm hidden-xs">
        <div class="github-fork-ribbon" style="background-color: #f80">
            <a href="https://github.com/opis/database">Fork me on GitHub</a>
        </div>
    </div>
    <header id="header" class="navbar navbar-default navbar-static-top">
        <div class="container">
            <div class="navbar-header">
                <img src="/assets/img/opis-gs-100.png" class="img-responsive opis-inline-logo">
                <a href="/database/3.6" class="navbar-brand">
                    <strong>
                        Database
                    </strong>
                </a>
                <button data-target="#navbar-main" data-toggle="collapse" type="button" class="navbar-toggle">
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
            </div>
            <nav id="navbar-main" class="collapse navbar-collapse navbar-right">
                <ul class="nav navbar-nav">
                    <li>
                        <a href="/" title="Main page">
                            <span class="fa fa-home"></span> Home
                        </a>
                    </li>
                    <li class="dropdown hidden-md hidden-lg">
    <a class="dropdown-toggle" data-toggle="dropdown" href="#">
        <span class="fa fa-file-text"></span> Documentation <span class="caret"></span>
    </a>
    <ul class="dropdown-menu">
            <li class="dropdown-header">Getting started</li>
            <li><a href="/database/3.6/index" title="Getting started with Opis Database">About</a></li>
            <li><a href="/database/3.6/connections" title="Learn how to connect to a database">Database connections</a></li>
            <li class="dropdown-header">The basics</li>
            <li><a href="/database/3.6/fetching-records" title="Fetching records from a database">Fetching records</a></li>
            <li class="active"><a href="/database/3.6/results-handling" title="Learn how to handle the result set of a query">Results handling</a></li>
            <li><a href="/database/3.6/aggregate-functions" title="Learn about aggregate functions">Aggregate functions</a></li>
            <li><a href="/database/3.6/extended-selections" title="Learn about how to define custom selections">Extended selections</a></li>
            <li><a href="/database/3.6/filters" title="Learn how to filter records">Filter</a></li>
            <li><a href="/database/3.6/expressions" title="Learn about expressions">Expressions</a></li>
            <li><a href="/database/3.6/ordering-criteria" title="Learn how to order results">Ordering criteria</a></li>
            <li><a href="/database/3.6/limits-and-offsets" title="Learn about limits and offsets">Limits and offset</a></li>
            <li><a href="/database/3.6/joins" title="Learn how to perform joins">Joins</a></li>
            <li><a href="/database/3.6/aggregates-handling" title="Learn how to work with aggregates">Working with aggregates</a></li>
            <li><a href="/database/3.6/insert-records" title="Insert new records into a table">Insert records</a></li>
            <li><a href="/database/3.6/update-records" title="Learn how to update existing records">Update records</a></li>
            <li><a href="/database/3.6/delete-records" title="Learn how to delete existing records">Delete records</a></li>
            <li class="dropdown-header">Transactions</li>
            <li><a href="/database/3.6/transactions" title="Learn how to use transactions">Performing transactions</a></li>
            <li class="dropdown-header">Database schema</li>
            <li><a href="/database/3.6/schema" title="Learn about Opis Database schema">Introduction</a></li>
            <li><a href="/database/3.6/schema-creating-tables" title="Learn how to create new tables">Creating tables</a></li>
            <li><a href="/database/3.6/schema-modifying-tables" title="Learn how to alter existing new tables">Modifying tables</a></li>
            <li class="dropdown-header">ORM</li>
            <li><a href="/database/3.6/orm" title="Learn about Opis Database ORM">Introduction</a></li>
            <li><a href="/database/3.6/orm-basics" title="Learn how to use Opis Database ORM">Basic operations</a></li>
            <li><a href="/database/3.6/orm-relationships" title="Learn about ORM relationships">Relationships</a></li>
            <li><a href="/database/3.6/orm-models" title="Learn how to work with models">Working with models</a></li>
    </ul>
</li>
                    <li class="dropdown">
                        <a class="dropdown-toggle" data-toggle="dropdown" href="#">
                            <span class="fa fa-cogs"></span> Components <span class="caret"></span>
                        </a>
                        <ul class="dropdown-menu">
                            <li><a href="/cache/3.1">Cache</a></li>
                            <li><a href="/closure/2.3">Closure</a></li>
                            <li><a href="/config/2.1">Config</a></li>
                            <li><a href="/container/2.3">Container</a></li>
                            <li><a href="/database/3.6">Database</a></li>
                            <li><a href="/events/4.1">Events</a></li>
                            <li><a href="/http/2.0">HTTP</a></li>
                            <li><a href="/http-routing/4.0">HTTP Routing</a></li>
                            <li><a href="/routing/4.1">Routing</a></li>
                            <li><a href="/session/3.1">Session</a></li>
                            <li><a href="/view/4.1">View</a></li>
                        </ul>
                    </li>
                    <li class="hidden-md hidden-lg">
                        <a href="https://github.com/opis/database" title="Github page">
                            <span class="fa fa-github fa-lg"></span> GitHub
                        </a>
                    </li>
                </ul>
            </nav>
        </div>
    </header>
    <section>
        <div class="container">
            <div class="row">
                <div class="col-md-4 hidden-xs hidden-sm">
<ul class="navigation">
            <li class="chapter">Getting started</li>
            <ul>
                <li><a href="/database/3.6/index" title="Getting started with Opis Database">About</a></li>
            <li><a href="/database/3.6/connections" title="Learn how to connect to a database">Database connections</a></li>
                </ul>
            <li class="chapter">The basics</li>
            <ul>
                <li><a href="/database/3.6/fetching-records" title="Fetching records from a database">Fetching records</a></li>
            <li class="active"><a href="/database/3.6/results-handling" title="Learn how to handle the result set of a query">Results handling</a></li>
            <li><a href="/database/3.6/aggregate-functions" title="Learn about aggregate functions">Aggregate functions</a></li>
            <li><a href="/database/3.6/extended-selections" title="Learn about how to define custom selections">Extended selections</a></li>
            <li><a href="/database/3.6/filters" title="Learn how to filter records">Filter</a></li>
            <li><a href="/database/3.6/expressions" title="Learn about expressions">Expressions</a></li>
            <li><a href="/database/3.6/ordering-criteria" title="Learn how to order results">Ordering criteria</a></li>
            <li><a href="/database/3.6/limits-and-offsets" title="Learn about limits and offsets">Limits and offset</a></li>
            <li><a href="/database/3.6/joins" title="Learn how to perform joins">Joins</a></li>
            <li><a href="/database/3.6/aggregates-handling" title="Learn how to work with aggregates">Working with aggregates</a></li>
            <li><a href="/database/3.6/insert-records" title="Insert new records into a table">Insert records</a></li>
            <li><a href="/database/3.6/update-records" title="Learn how to update existing records">Update records</a></li>
            <li><a href="/database/3.6/delete-records" title="Learn how to delete existing records">Delete records</a></li>
                </ul>
            <li class="chapter">Transactions</li>
            <ul>
                <li><a href="/database/3.6/transactions" title="Learn how to use transactions">Performing transactions</a></li>
                </ul>
            <li class="chapter">Database schema</li>
            <ul>
                <li><a href="/database/3.6/schema" title="Learn about Opis Database schema">Introduction</a></li>
            <li><a href="/database/3.6/schema-creating-tables" title="Learn how to create new tables">Creating tables</a></li>
            <li><a href="/database/3.6/schema-modifying-tables" title="Learn how to alter existing new tables">Modifying tables</a></li>
                </ul>
            <li class="chapter">ORM</li>
            <ul>
                <li><a href="/database/3.6/orm" title="Learn about Opis Database ORM">Introduction</a></li>
            <li><a href="/database/3.6/orm-basics" title="Learn how to use Opis Database ORM">Basic operations</a></li>
            <li><a href="/database/3.6/orm-relationships" title="Learn about ORM relationships">Relationships</a></li>
            <li><a href="/database/3.6/orm-models" title="Learn how to work with models">Working with models</a></li>
    </ul>
</ul>
                </div>
                <div class="col-md-8 col-sm-12">
                    <h1 id="results-handling">Results handling</h1>
<ol>
  <li><a href="#introduction">Introduction</a></li>
  <li><a href="#using-the-cursor">Using the cursor</a></li>
  <li><a href="#fetching-options">Fetching options</a></li>
  <li><a href="#callback-functions">Callback functions</a></li>
</ol>
<h2 id="introduction">Introduction</h2>
<p>As you have already learned, <a href="fetch-records">fetching records</a> 
is done by using the <code>select</code> method. In order to improve performance and to
 provide developers a greater control over the result set returned by a query, 
instead of simply returning a list with results, the <code>select</code> method returns a 
cursor to a result set, represented by an instance of the <code>Opis\Database\ResultSet</code> class. 
This class contains various methods used in data handling, including the <code>all</code> method 
that was presented in the previous section.</p>
<h2 id="using-the-cursor">Using the cursor</h2>
<p>Using the <code>all</code> method is perfectly fine when we are dealing with reasonable 
data sets, but we can quickly run out of memory if we are dealing with large data sets.
 This is because the <code>all</code> method transfers all the results from the database into PHP’s 
memory and stores them into an array. One solution to avoid going out of memory when 
dealing with large data sets is to iterate through the entire result set and process one result at a time.</p><pre><code class="language-php">$result = $db-&gt;from('users')
             -&gt;select(['name', 'email']);
             
while(false !== $user = $result-&gt;next())
{
    echo $user-&gt;name, $user-&gt;email;
}
</code></pre>
<h2 id="fetching-options">Fetching options</h2>
<p>By default the results of a query are fetched as anonymous objects with property 
names that correspond to the column names returned in your result set.
You can change this behavior by using a set of methods provided by the 
<code>Opis\Database\ResultSet</code> class.</p>
<p>Fetching records as an array indexed by column name is done using the <code>fetchAssoc</code> method.</p><pre><code class="language-php">$result = $db-&gt;from('users')
             -&gt;select(['name', 'email'])
             -&gt;fetchAssoc()
             -&gt;all();
             
foreach($result as $user)
{
    echo $user['name'], $user['email'];
}
</code></pre>
<p>Fetching records as an array indexed by column number, starting at column 0, 
is done using the <code>fetchNum</code> method.</p><pre><code class="language-php">$result = $db-&gt;from('users')
             -&gt;select(['name', 'email'])
             -&gt;fetchNum()
             -&gt;all();
             
foreach($result as $user)
{
    echo $user[0], $user[1];
}
</code></pre>
<p>The <code>fetchBoth</code> method fetch each record as an array indexed by both column name and column number.</p><pre><code class="language-php">$result = $db-&gt;from('users')
             -&gt;select(['name', 'email'])
             -&gt;fetchBoth()
             -&gt;all();
             
foreach($result as $user)
{
    //prints name and email
    echo $user['name'], $user[1];
}
</code></pre>
<p>The <code>fetchNamed</code> method is similar to <code>fetchAssoc</code> method, except that if there
are multiple columns with the same name, the value referred to by that key will
be an array of all the values in the row that had that column name.</p>
<p>You can map the columns of the result set to named properties in a custom class 
by using the <code>fetchClass</code> method. The method accepts as arguments a class name 
and optionally an array of arguments that will be passed to the class constructor.</p>
<p class="well text-primary"><strong class="important">Important!</strong>
The named properties of your class that will be mapped to column
names must have <code>public</code> access.</p><pre><code class="language-php">class User
{
    public $name;
    public $email;
    
    public function test()
    {
        echo $this-&gt;name, $this-&gt;email;
    }
}

$result = $db-&gt;from('users')
             -&gt;select(['name', 'email'])
             -&gt;fetchClass('User')
             -&gt;all();
             
foreach($result as $user)
{
    $user-&gt;test();
}
</code></pre>
<h2 id="callback-functions">Callback functions</h2>
<p><strong>Opis Database</strong> allows you to specify a callback function that can be passed 
as an argument to the <code>all</code> and the <code>first</code> methods. Records are mapped to the 
result of calling the callback function using each row’s columns as parameters in the call.</p><pre><code class="language-php">class User
{
    protected $name;
    protected $email;
    
    public function __construct($name, $email)
    {
        $this-&gt;name = $name;
        $this-&gt;email = $email;
    }
    
    public function getName()
    {
        return $this-&gt;name;
    }
    
    public function getEmail()
    {
        return $this-&gt;email;
    }
    
    public function sendEmail($subject, $message)
    {
        mail($this-&gt;email, $subject, $message);
    }
    
}

$result = $db-&gt;from('users')
             -&gt;select(['name', 'email'])
             -&gt;all(function($name, $email){
                return new User($name, $email);
             });

$message = "Opis Database is great! http://www.opis.io/database";
             
foreach($result as $user)
{
    $subject = "Hello " . $user-&gt;getName();
    $user-&gt;sendEmail($subject, $message);
}
</code></pre>
<ul class="pager">
        <li class="previous"><a href="/database/3.6/fetching-records" title="Fetching records">&larr; Back</a></li>
        <li class="next"><a href="/database/3.6/aggregate-functions" title="Aggregate functions">Next &rarr;</a></li>
</ul>
                </div>
            </div>
        </div>
    </section>
    <a href="#0" id="back-to-top">
    <span class="fa fa-arrow-up"></span>
</a>
<script>
    (function($){
        $(document).ready(function(){
            var visible = false;
            $(window).scroll(function(){
                var top = $(this).scrollTop();
                if (top >= 100 && !visible) {
                    visible = true;
                    $('#back-to-top').fadeIn().show();
                }
                if(top < 100 && visible){
                    visible = false;
                    $('#back-to-top').fadeOut();
                }
            });
            $('#back-to-top').click(function(){
                $('html, body').animate({scrollTop : 0},800);
                return false;
            });
        });
        $('h2[id],h3[id],h4[id],h5[id],h6[id]').each(function () {
            var child = $('<a href="#' + this.getAttribute('id') + '" class="link-anchor"><span class="fa fa-link"></span></a>');
            this.appendChild(child.get(0));
        });
        $('[data-toggle=tooltip]').tooltip();
    })(jQuery);
</script>
    <footer class="text-center text-muted">
        Copyright &copy; 2014-2016 The Opis Project. All rights reserved.
    </footer>
</body>
</html>
