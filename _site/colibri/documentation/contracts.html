<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="keywords" content="php, full-stack, framework, php framework, modules, modular framework">
<meta name="description" content="Learn about Opis Colibri contracts">
<title>Contracts | Opis Colibri</title>
        
        <link href="/assets/img/favicon.png" rel="shortcut icon">
        
        
        
<link rel="stylesheet" href="/assets/css/paper-theme.min.css">

<link href="/assets/css/font-awesome.css" rel="stylesheet">

<link href="/assets/css/syntax.css" rel="stylesheet">



<link href="/assets/css/colibri.css" rel="stylesheet">


        
        <!--[if lt IE 9]>
<script src="/assets/js/html5shiv.js"></script>
<script src="/assets/js/respond.min.js"></script>
<![endif]-->
<!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
<script src="/assets/js/jquery-1.11.0.min.js"></script>
<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="/assets/js/bootstrap.min.js"></script>


<script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  
    ga('create', 'UA-50415801-1', 'opis.io');
    ga('send', 'pageview');
</script>

    </head>
    <body>
        <header id="header" class="navbar navbar-default">
    <div class="container">
        <div class="navbar-header">
            <a href="/colibri">
                <img src="/assets/img/opis-colibri.png" class="img-responsive opis-inline-logo">
            </a>
            <button data-target="#navbar-main" data-toggle="collapse" type="button" class="navbar-toggle">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
        </div>
        <nav id="navbar-main" class="collapse navbar-collapse navbar-right">
            <ul class="nav navbar-nav">
                <li>
                    <a href="/colibri/documentation" title="Documentation">
                        <span class="fa fa-file-text"></span> Documentation
                    </a>
                </li>
                <li>
                    <a href="https://github.com/opis/colibri" title="Github page">
                        <span class="fa fa-github fa-lg"></span> GitHub
                    </a>
                </li>
                <li>
                    <a href="/" title="Main page">
                        <span class="fa fa-home"></span> Home
                    </a>
                </li>
            </ul>
        </nav>
    </div>
</header>

<section>
    <div class="container">
    <div class="row">
        <div class="col-md-4">
            
<ul class="navigation">

    
        
            
        
        <li class="chapter">Quick start</li>
        <ul>
            <li><a href="/colibri/documentation" title="Learn how to install Opis Colibri">Installation</a></li>
    

    
        
        </ul>
        
        <li class="chapter">The basics</li>
        <ul>
            <li><a href="/colibri/documentation/modules.html" title="Learn about modules and how to create them">Modules</a></li>
    

    
        <li><a href="/colibri/documentation/collectors.html" title="Learn about collectors and how to use them">Collectors</a></li>
    

    
        <li><a href="/colibri/documentation/installer.html" title="Learn about installers and what they do">Installers</a></li>
    

    
        <li><a href="/colibri/documentation/classes.html" title="Learn about modules' classes">Classes</a></li>
    

    
        <li><a href="/colibri/documentation/assets.html" title="Learn about Opis Colibri assets">Assets</a></li>
    

    
        <li><a href="/colibri/documentation/functions.html" title="Learn about framework's global functions">Global functions</a></li>
    

    
        
        </ul>
        
        <li class="chapter">Administration</li>
        <ul>
            <li><a href="/colibri/documentation/console.html" title="Learn about available console commands">Console commands</a></li>
    

    
        
        </ul>
        
        <li class="chapter">Collectible items</li>
        <ul>
            <li><a href="/colibri/documentation/routes.html" title="Learn about Opis Colibri routes">Routes</a></li>
    

    
        <li><a href="/colibri/documentation/route-aliases.html" title="Learn about Opis Colibri route aliases">Route aliases</a></li>
    

    
        <li><a href="/colibri/documentation/dispatchers.html" title="Learn about Opis Colibri dispatchers">Dispatchers</a></li>
    

    
        <li><a href="/colibri/documentation/views.html" title="Learn about Opis Colibri views">Views</a></li>
    

    
        <li><a href="/colibri/documentation/view-engines.html" title="Learn about Opis Colibri view engines">View engines</a></li>
    

    
        <li><a href="/colibri/documentation/contracts.html" title="Learn about Opis Colibri contracts">Contracts</a></li>
    

    
        <li><a href="/colibri/documentation/commands.html" title="Learn how to define new commands">Commands</a></li>
    

    
        <li><a href="/colibri/documentation/events.html" title="Learn about Opis Colibri event handlers">Event handlers</a></li>
    

    
        <li><a href="/colibri/documentation/databases.html" title="Learn about database connections">Database connections</a></li>
    

    
        <li><a href="/colibri/documentation/session.html" title="Learn about Opis Colibri sessions">Session storages</a></li>
    

    
        <li><a href="/colibri/documentation/cache.html" title="Learn about Opis Colibri cache storages">Cache storages</a></li>
    

    
        <li><a href="/colibri/documentation/config.html" title="Learn about Opis Colibri config storages">Config storages</a></li>
    

    
        <li><a href="/colibri/documentation/validators.html" title="Learn about Opis Colibri validators">Validators</a></li>
    

    
        <li><a href="/colibri/documentation/translations.html" title="Learn about Opis Colibri translations">Translations</a></li>
    

    
        <li><a href="/colibri/documentation/variables.html" title="Learn about Opis Colibri variables">Variables</a></li>
    

    </ul>
</ul>

        </div>
        <div class="col-md-8">
            
    


    

<h2>
    
    Contracts
    
</h2>

<ol class="submenu">
    <li>




    

<a href="#introduction">Introduction</a></li>
    <li>




    

<a href="#defining-contracts">Defining contracts</a></li>
    <li>




    

<a href="#how-to-use-them">How to use them</a></li>
</ol>


        


    


    


    

<h3>
    
    
    Introduction
    
    <a id="introduction" href="#introduction" class="link-anchor"><span class="fa fa-link"></span></a>
</h3>

<p>
    The contracts mechanism allows developers to map an abstract type to a concrete type.
    This mechanism is based on the <a href="/container" target="_blank">Opis Container</a> library.
    Contracts are collected using the <code>Contracts</code> method.
</p>

<div class="highlight"><pre><code class="php"><span class="k">use</span> <span class="nx">Opis\Colibri\Define</span><span class="p">;</span>

<span class="nx">Define</span><span class="o">::</span><span class="na">Contracts</span><span class="p">(</span><span class="k">function</span><span class="p">(</span><span class="nv">$contract</span><span class="p">){</span>

    <span class="c1">// Collect contracts</span>

<span class="p">});</span>
</code></pre></div>

<p>
    You can override registred contracts by specifying a lower collecting priority.
</p>

<div class="highlight"><pre><code class="php"><span class="k">use</span> <span class="nx">Opis\Colibri\Define</span><span class="p">;</span>

<span class="c1">// Override all contracts that have a collecting priority greater than -1</span>
<span class="nx">Define</span><span class="o">::</span><span class="na">Contracts</span><span class="p">(</span><span class="k">function</span><span class="p">(</span><span class="nv">$dispatcher</span><span class="p">){</span>

    <span class="c1">// Collect contracts</span>

<span class="p">},</span> <span class="o">-</span><span class="mi">1</span><span class="p">);</span>
</code></pre></div>

<p>
    The collector passed to the callback function is an object that implements
    the <code>Opis\Colibri\ContractCollectorInterface</code> interface.
</p>

<div class="highlight"><pre><code class="php"><span class="k">interface</span> <span class="nx">ContractCollectorInterface</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Register a binding with the container.</span>
<span class="sd">     *</span>
<span class="sd">     * @param   string          $abstract   Class name or interface name</span>
<span class="sd">     * @param   \Closure|string $concrete   (optional) Concrete class or interface implementation</span>
<span class="sd">     *</span>
<span class="sd">     * @return  \Opis\Container\Dependency</span>
<span class="sd">     */</span>
    
    <span class="k">public</span> <span class="k">function</span> <span class="nf">bind</span><span class="p">(</span><span class="nv">$abstract</span><span class="p">,</span> <span class="nv">$concrete</span> <span class="o">=</span> <span class="k">null</span><span class="p">);</span>
    
    <span class="sd">/**</span>
<span class="sd">     * Alias a type.</span>
<span class="sd">     *</span>
<span class="sd">     * @param   string  $concrete   Concrete class or interface name</span>
<span class="sd">     * @param   string  $alias      An alias for the specified class or interface</span>
<span class="sd">     *</span>
<span class="sd">     * @return  \Opis\Colibri\ContractCollectorInterface    Self reference</span>
<span class="sd">     */</span>
    
    <span class="k">public</span> <span class="k">function</span> <span class="nf">alias</span><span class="p">(</span><span class="nv">$concrete</span><span class="p">,</span> <span class="nv">$alias</span><span class="p">);</span>
    
    
    <span class="sd">/**</span>
<span class="sd">     * Extends a registered type.</span>
<span class="sd">     *</span>
<span class="sd">     * @param   string      $abstract</span>
<span class="sd">     * @param   \Closure    $alias</span>
<span class="sd">     *</span>
<span class="sd">     * @return  \Opis\Container\Extender</span>
<span class="sd">     */</span>
    
    <span class="k">public</span> <span class="k">function</span> <span class="nf">extend</span><span class="p">(</span><span class="nv">$abstract</span><span class="p">,</span> <span class="nx">Closure</span> <span class="nv">$extender</span><span class="p">);</span>
    
    
    <span class="sd">/**</span>
<span class="sd">     * Register a singleton binding with the container.</span>
<span class="sd">     *</span>
<span class="sd">     * @param   string          $abstract   Class name or interface name</span>
<span class="sd">     * @param   \Closure|string $concrete   (optional) Concrete class or interface implementation</span>
<span class="sd">     *</span>
<span class="sd">     * @return  \Opis\Container\Dependency</span>
<span class="sd">     */</span>
    
    <span class="k">public</span> <span class="k">function</span> <span class="nf">singleton</span><span class="p">(</span><span class="nv">$abstract</span><span class="p">,</span> <span class="nv">$concrete</span> <span class="o">=</span> <span class="k">null</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>


        


    


    


    

<h3>
    
    
    Defining contracts
    
    <a id="defining-contracts" href="#defining-contracts" class="link-anchor"><span class="fa fa-link"></span></a>
</h3>

<p>
    A contract is defined by passing the abstract type and the concrete type to the <code>bind</code> method.
</p>

<div class="highlight"><pre><code class="php"><span class="k">use</span> <span class="nx">Opis\Colibri\Define</span><span class="p">;</span>

<span class="nx">Define</span><span class="o">::</span><span class="na">Contracts</span><span class="p">(</span><span class="k">function</span><span class="p">(</span><span class="nv">$contract</span><span class="p">){</span>

    <span class="nv">$contract</span><span class="o">-&gt;</span><span class="na">bind</span><span class="p">(</span><span class="s1">&#39;Namespace\FooInterface&#39;</span><span class="p">,</span> <span class="s1">&#39;Namespace\FooClass&#39;</span><span class="p">);</span>

<span class="p">});</span>
</code></pre></div>

<p>
    You can also pass a closure instead of a concrete type. The closure receive as arguments
    the DI container instance and an array, representing the arguments passed to the concrete class,
    and it must return a concrete object that implements the abstract type.
</p>

<div class="highlight"><pre><code class="php"><span class="k">use</span> <span class="nx">Opis\Colibri\Define</span><span class="p">;</span>

<span class="nx">Define</span><span class="o">::</span><span class="na">Contracts</span><span class="p">(</span><span class="k">function</span><span class="p">(</span><span class="nv">$contract</span><span class="p">){</span>

    <span class="nv">$contract</span><span class="o">-&gt;</span><span class="na">bind</span><span class="p">(</span><span class="s1">&#39;Namespace\FooInterface&#39;</span><span class="p">,</span> <span class="k">function</span><span class="p">(</span><span class="nv">$container</span><span class="p">,</span> <span class="nv">$args</span><span class="p">){</span>
        
        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$args</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
        <span class="p">{</span>
            <span class="nv">$args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;foo&#39;</span><span class="p">;</span>
        <span class="p">}</span>
        
        <span class="k">return</span> <span class="k">new</span> <span class="nx">\Namespace\FooClass</span><span class="p">(</span><span class="nv">$args</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
    <span class="p">});</span>

<span class="p">});</span>
</code></pre></div>


    


    


    


    

<h5>
    
    
    Singletons
    
    <a id="singletons" href="#singletons" class="link-anchor"><span class="fa fa-link"></span></a>
</h5>

<p>
    Occasionally is desirable that some types to be resolved once,
    and the same object to be returned on subsequent calls into the container.
    To achieve this behavior, simply bind the abstract type using the <code>singleton</code> method.
    This method takes same arguments as the <code>bind</code> method. 
</p>

<div class="highlight"><pre><code class="php"><span class="k">use</span> <span class="nx">Opis\Colibri\Define</span><span class="p">;</span>

<span class="nx">Define</span><span class="o">::</span><span class="na">Contracts</span><span class="p">(</span><span class="k">function</span><span class="p">(</span><span class="nv">$contract</span><span class="p">){</span>

    <span class="nv">$contract</span><span class="o">-&gt;</span><span class="na">singleton</span><span class="p">(</span><span class="s1">&#39;Namespace\FooInterface&#39;</span><span class="p">,</span> <span class="s1">&#39;Namespace\FooClass&#39;</span><span class="p">);</span>
    
    <span class="nv">$contract</span><span class="o">-&gt;</span><span class="na">singleton</span><span class="p">(</span><span class="s1">&#39;Namespace\BarInterface&#39;</span><span class="p">,</span> <span class="k">function</span><span class="p">(</span><span class="nv">$container</span><span class="p">,</span> <span class="nv">$args</span><span class="p">){</span>
        
        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$args</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
        <span class="p">{</span>
            <span class="nv">$args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;bar&#39;</span><span class="p">;</span>
        <span class="p">}</span>
        
        <span class="k">return</span> <span class="k">new</span> <span class="nx">\Namespace\BarClass</span><span class="p">(</span><span class="nv">$args</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
    <span class="p">});</span>

<span class="p">});</span>
</code></pre></div>


    


    


    


    

<h5>
    
    
    Type aliases
    
    <a id="type-aliases" href="#type-aliases" class="link-anchor"><span class="fa fa-link"></span></a>
</h5>

<p>
    You can alias a type by passing to the <code>alias</code> method the type's name and the
    alias name.
</p>

<div class="highlight"><pre><code class="php"><span class="k">use</span> <span class="nx">Opis\Colibri\Define</span><span class="p">;</span>

<span class="nx">Define</span><span class="o">::</span><span class="na">Contracts</span><span class="p">(</span><span class="k">function</span><span class="p">(</span><span class="nv">$contract</span><span class="p">){</span>

    <span class="nv">$contract</span><span class="o">-&gt;</span><span class="na">alias</span><span class="p">(</span><span class="s1">&#39;Very\Long\Namespace\FooInterface&#39;</span><span class="p">,</span> <span class="s1">&#39;FooAlias&#39;</span><span class="p">);</span>

<span class="p">});</span>
</code></pre></div>


    


    


    


    

<h5>
    
    
    Extending types
    
    <a id="extending-types" href="#extending-types" class="link-anchor"><span class="fa fa-link"></span></a>
</h5>

<p>
    You can extend an already bound abstract type by calling the <code>extend</code> method.
    The method takes as arguments the type that you want to extend and an anonymous function callback
    that will return an instance of the abstract type that extends the current implementation.
    The callback receive as arguments a resolved instance of the abstract type and the instance of the DI container.
</p>


<div class="highlight"><pre><code class="php"><span class="k">use</span> <span class="nx">Opis\Colibri\Define</span><span class="p">;</span>

<span class="nx">Define</span><span class="o">::</span><span class="na">Contracts</span><span class="p">(</span><span class="k">function</span><span class="p">(</span><span class="nv">$contract</span><span class="p">){</span>

    <span class="nv">$contract</span><span class="o">-&gt;</span><span class="na">bind</span><span class="p">(</span><span class="s1">&#39;Namespace\FooInterface&#39;</span><span class="p">,</span> <span class="s1">&#39;Namespace\FooClass&#39;</span><span class="p">);</span>
    
    <span class="nv">$contract</span><span class="o">-&gt;</span><span class="na">extend</span><span class="p">(</span><span class="s1">&#39;Namespace\FooInterface&#39;</span><span class="p">,</span> <span class="k">function</span><span class="p">(</span><span class="nv">$instance</span><span class="p">,</span> <span class="nv">$container</span><span class="p">){</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nx">\Namespace\Bar</span><span class="p">(</span><span class="nv">$instance</span><span class="p">);</span>
    <span class="p">});</span>

<span class="p">});</span>
</code></pre></div>


    


    


    


    

<h5>
    
    
    Setters
    
    <a id="setters" href="#setters" class="link-anchor"><span class="fa fa-link"></span></a>
</h5>

<p>
    Making various settings on the resolved instance of an abstract type can be acomplished
    by using the <code>setter</code> method. The method takes as argument an anonymous callback function
    that receive as arguments the resolved instance and the DI container.
</p>

<div class="highlight"><pre><code class="php"><span class="k">use</span> <span class="nx">Opis\Colibri\Define</span><span class="p">;</span>

<span class="nx">Define</span><span class="o">::</span><span class="na">Contracts</span><span class="p">(</span><span class="k">function</span><span class="p">(</span><span class="nv">$contract</span><span class="p">){</span>

    <span class="nv">$contract</span><span class="o">-&gt;</span><span class="na">bind</span><span class="p">(</span><span class="s1">&#39;Namespace\FooInterface&#39;</span><span class="p">,</span> <span class="s1">&#39;Namespace\FooClass&#39;</span><span class="p">)</span>
             <span class="o">-&gt;</span><span class="na">setter</span><span class="p">(</span><span class="k">function</span><span class="p">(</span><span class="nv">$instance</span><span class="p">,</span> <span class="nv">$container</span><span class="p">){</span>
                <span class="nv">$instance</span><span class="o">-&gt;</span><span class="na">foo</span><span class="p">(</span><span class="s1">&#39;bar&#39;</span><span class="p">);</span>
             <span class="p">});</span>

<span class="p">});</span>
</code></pre></div>


        


    


    


    

<h3>
    
    
    How to use them
    
    <a id="how-to-use-them" href="#how-to-use-them" class="link-anchor"><span class="fa fa-link"></span></a>
</h3>

<p>
    All abstract types defined by contracts can be instantiated with the help of
    the <a href="functions.html">Using</a> global function. The function takes as arguments
    the abstract type's name and optionally an array of values that will be used as arguments when
    the abstract type is resolved.
</p>

<div class="highlight"><pre><code class="php"><span class="nx">Using</span><span class="p">(</span><span class="s1">&#39;Namespace\FooInterface&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">bar</span><span class="p">(</span><span class="s1">&#39;baz&#39;</span><span class="p">);</span>
<span class="nx">Using</span><span class="p">(</span><span class="s1">&#39;BarInterface&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="s1">&#39;bar&#39;</span><span class="p">))</span><span class="o">-&gt;</span><span class="na">baz</span><span class="p">();</span>
</code></pre></div>

            





    
        
            
                
            
        
    

    
        
            
                
            
        
    

    
        
            
                
            
        
    

    
        
            
                
            
        
    

    
        
            
                
            
        
    

    
        
            
                
            
        
    

    
        
            
                
            
        
    

    
        
            
                
            
        
    

    
        
            
                
            
        
    

    
        
            
                
            
        
    

    
        
            
                
            
        
    

    
        
            
                
            
        
    

    
        
            
                
            
        
    

    
        
            
        
    

    
        
            
                
                
            
        
    

    

    

    

    

    

    

    

    


<ul class="pager">
  
  <li class="previous"><a href="/colibri/documentation/view-engines.html" title="View engines">&larr; Back</a></li>
  
  
  <li class="next"><a href="/colibri/documentation/commands.html" title="Commands">Next &rarr;</a></li>
  
</ul>
            
        </div>
    </div>
    <a href="#0" id="back-to-top">
        <span class="fa fa-arrow-up"></span>
    </a>
</div>
<script>
    (function($){
        
        $(document).ready(function(){
           var visible = false;
           $(window).scroll(function(){
                var top = $(this).scrollTop();
                
                if (top >= 100 && !visible) {
                   visible = true;
                   $('#back-to-top').fadeIn().show();
                 }
                 if(top < 100 && visible){
                   visible = false;
                   $('#back-to-top').fadeOut();  
                 }
           });
           
            $('#back-to-top').click(function(){
                $('html, body').animate({scrollTop : 0},800);
                return false;
            });
            
        });
        
        
    })(jQuery);
</script>
</section>

<footer class="text-center text-muted">
    Copyright &copy; 2014-2015 Marius Sarca. All rights reserved.
</footer>

    </body>
</html>
