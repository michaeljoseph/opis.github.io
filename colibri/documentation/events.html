<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="keywords" content="php, full-stack, framework, php framework, modules, modular framework">
<meta name="description" content="Learn about Opis Colibri event handlers">
<title>Event handlers | Opis Colibri</title>
        
        <link href="/assets/img/favicon.png" rel="shortcut icon">
        
        
        
<link rel="stylesheet" href="/assets/css/paper-theme.min.css">

<link href="/assets/css/font-awesome.css" rel="stylesheet">

<link href="/assets/css/syntax.css" rel="stylesheet">



<link href="/assets/css/colibri.css" rel="stylesheet">


        <!--[if lt IE 9]>
<script src="/assets/js/html5shiv.js"></script>
<script src="/assets/js/respond.min.js"></script>
<![endif]-->
<!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
<script src="/assets/js/jquery-1.11.0.min.js"></script>
<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="/assets/js/bootstrap.min.js"></script>


<script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  
    ga('create', 'UA-50415801-1', 'opis.io');
    ga('send', 'pageview');
</script>

    </head>
    <body>
        <header id="header" class="navbar navbar-default">
    <div class="container">
        <div class="navbar-header">
            <a href="/colibri">
                <img src="/assets/img/opis-colibri.png" class="img-responsive opis-inline-logo">
            </a>
            <button data-target="#navbar-main" data-toggle="collapse" type="button" class="navbar-toggle">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
        </div>
        <nav id="navbar-main" class="collapse navbar-collapse navbar-right">
            <ul class="nav navbar-nav">
                <li>
                    <a href="/colibri/documentation" title="Documentation">
                        <span class="fa fa-file-text"></span> Documentation
                    </a>
                </li>
                <li>
                    <a href="https://github.com/opis/colibri" title="Github page">
                        <span class="fa fa-github fa-lg"></span> GitHub
                    </a>
                </li>
                <li>
                    <a href="/" title="Main page">
                        <span class="fa fa-home"></span> Home
                    </a>
                </li>
            </ul>
        </nav>
    </div>
</header>

<section>
    <div class="container">
    <div class="row">
        <div class="col-md-4">
            
<ul class="navigation">

    
        
            
        
        <li class="chapter">Quick start</li>
        <ul>
            <li><a href="/colibri/documentation" title="Learn how to install Opis Colibri">Installation</a></li>
    

    
        
        </ul>
        
        <li class="chapter">The basics</li>
        <ul>
            <li><a href="/colibri/documentation/modules.html" title="Learn about modules and how to create them">Modules</a></li>
    

    
        <li><a href="/colibri/documentation/collectors.html" title="Learn about collectors and how to use them">Collectors</a></li>
    

    
        <li><a href="/colibri/documentation/installer.html" title="Learn about installers and what they do">Installers</a></li>
    

    
        <li><a href="/colibri/documentation/classes.html" title="Learn about modules' classes">Classes</a></li>
    

    
        <li><a href="/colibri/documentation/assets.html" title="Learn about Opis Colibri assets">Assets</a></li>
    

    
        <li><a href="/colibri/documentation/functions.html" title="Learn about framework's global functions">Global functions</a></li>
    

    
        
        </ul>
        
        <li class="chapter">Administration</li>
        <ul>
            <li><a href="/colibri/documentation/commands.html" title="Learn about available commands">Console commands</a></li>
    

    
        
        </ul>
        
        <li class="chapter">Collectible items</li>
        <ul>
            <li><a href="/colibri/documentation/routes.html" title="Learn about Opis Colibri routes">Routes</a></li>
    

    
        <li><a href="/colibri/documentation/route-aliases.html" title="Learn about Opis Colibri route aliases">Route aliases</a></li>
    

    
        <li><a href="/colibri/documentation/dispatchers.html" title="Learn about Opis Colibri dispatchers">Dispatchers</a></li>
    

    
        <li><a href="/colibri/documentation/views.html" title="Learn about Opis Colibri views">Views</a></li>
    

    
        <li><a href="/colibri/documentation/view-engines.html" title="Learn about Opis Colibri view engines">View engines</a></li>
    

    
        <li><a href="/colibri/documentation/contracts.html" title="Learn about Opis Colibri contracts">Contracts</a></li>
    

    
        <li><a href="/colibri/documentation/events.html" title="Learn about Opis Colibri event handlers">Event handlers</a></li>
    

    
        <li><a href="/colibri/documentation/databases.html" title="Learn about database connections">Database connections</a></li>
    

    
        <li><a href="/colibri/documentation/session.html" title="Learn about Opis Colibri sessions">Session storages</a></li>
    

    
        <li><a href="/colibri/documentation/cache.html" title="Learn about Opis Colibri cache storages">Cache storages</a></li>
    

    
        <li><a href="/colibri/documentation/config.html" title="Learn about Opis Colibri config storages">Config storages</a></li>
    

    
        <li><a href="/colibri/documentation/validators.html" title="Learn about Opis Colibri validators">Validators</a></li>
    

    
        <li><a href="/colibri/documentation/translations.html" title="Learn about Opis Colibri translations">Translations</a></li>
    

    
        <li><a href="/colibri/documentation/variables.html" title="Learn about Opis Colibri variables">Variables</a></li>
    

    </ul>
</ul>

        </div>
        <div class="col-md-8">
            
    


    

<h2>
    
    Event handlers
    
</h2>

<ol class="submenu">
    <li>




    

<a href="#introduction">Introduction</a></li>
    <li>




    

<a href="#defining-event-handlers">Defining event handlers</a></li>
    <li>




    

<a href="#triggering-events">Triggering events</a></li>
    <li>




    

<a href="#framework-specific-events">Framework specific events</a></li>
</ol>


        


    


    


    

<h3>
    
    
    Introduction
    
    <a id="introduction" href="#introduction" class="link-anchor"><span class="fa fa-link"></span></a>
</h3>

<p>
    The event handling mechanism is based on the <a href="/events" target="_blank">Opis Events</a> library and
    allows developers to react to different events that might take place during the request's lifetime.
    Event handlers are collected using the <code>EventHadlers</code> method.
</p>

<div class="highlight"><pre><code class="php"><span class="k">use</span> <span class="nx">Opis\Colibri\Define</span><span class="p">;</span>

<span class="nx">Define</span><span class="o">::</span><span class="na">EventHandlers</span><span class="p">(</span><span class="k">function</span><span class="p">(</span><span class="nv">$handler</span><span class="p">){</span>

    <span class="c1">// Collect event handlers</span>

<span class="p">});</span>
</code></pre></div>

<p>
    The collector passed to the callback function is an object that implements
    the <code>Opis\Colibri\EventHandlerCollectorInterface</code> interface.
</p>

<div class="highlight"><pre><code class="php"><span class="k">interface</span> <span class="nx">EventHandlerCollectorInterface</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Register a new event handler</span>
<span class="sd">     *</span>
<span class="sd">     * @param   string      $event      Event name</span>
<span class="sd">     * @param   callable    $callback   A callback that will be executed</span>
<span class="sd">     * @param   int         $priority   Event handler&#39;s priority</span>
<span class="sd">     *</span>
<span class="sd">     * @return  \Opis\Events\EventHandler</span>
<span class="sd">     */</span>
    
    <span class="k">public</span> <span class="k">function</span> <span class="nf">handle</span><span class="p">(</span><span class="nv">$event</span><span class="p">,</span> <span class="nv">$callback</span><span class="p">,</span> <span class="nv">$priority</span> <span class="o">=</span> <span class="mi">0</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>


        


    


    


    

<h3>
    
    
    Defining event handlers
    
    <a id="defining-event-handlers" href="#defining-event-handlers" class="link-anchor"><span class="fa fa-link"></span></a>
</h3>

<p>
    Event handlers are defined by passing an event name and a callback value to the <code>handle</code> method.
    The callback value associated with the event name will be executed every time the specified event is triggerd.
    The callback recives as an argument an object that inherits form the <code>Opis\Colibri\Event</code> class.
</p>

<div class="highlight"><pre><code class="php"><span class="k">use</span> <span class="nx">Opis\Colibri\Define</span><span class="p">;</span>

<span class="nx">Define</span><span class="o">::</span><span class="na">EventHandlers</span><span class="p">(</span><span class="k">function</span><span class="p">(</span><span class="nv">$handler</span><span class="p">){</span>

    <span class="nv">$handler</span><span class="o">-&gt;</span><span class="na">handle</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="k">function</span><span class="p">(</span><span class="nv">$event</span><span class="p">){</span>
        <span class="c1">// Handle event</span>
    <span class="p">});</span>

<span class="p">});</span>
</code></pre></div>

<p>
    The name of the intercepted event can be splitted into segments separated by <code>.</code> signs.
</p>

<div class="highlight"><pre><code class="php"><span class="k">use</span> <span class="nx">Opis\Colibri\Define</span><span class="p">;</span>

<span class="nx">Define</span><span class="o">::</span><span class="na">EventHandlers</span><span class="p">(</span><span class="k">function</span><span class="p">(</span><span class="nv">$handler</span><span class="p">){</span>

    <span class="nv">$handler</span><span class="o">-&gt;</span><span class="na">handle</span><span class="p">(</span><span class="s1">&#39;foo.bar&#39;</span><span class="p">,</span> <span class="k">function</span><span class="p">(</span><span class="nv">$event</span><span class="p">){</span>
        <span class="c1">// Handle event</span>
    <span class="p">});</span>

<span class="p">});</span>
</code></pre></div>

<p>
    You can apply filters to your event handlers by defining regex constraints. Defining a regex constraint
    is done using the <code>where</code> method.
</p>

<div class="highlight"><pre><code class="php"><span class="k">use</span> <span class="nx">Opis\Colibri\Define</span><span class="p">;</span>

<span class="nx">Define</span><span class="o">::</span><span class="na">EventHandlers</span><span class="p">(</span><span class="k">function</span><span class="p">(</span><span class="nv">$handler</span><span class="p">){</span>

    <span class="nv">$handler</span><span class="o">-&gt;</span><span class="na">handle</span><span class="p">(</span><span class="s1">&#39;foo.{bar}&#39;</span><span class="p">,</span> <span class="k">function</span><span class="p">(</span><span class="nv">$event</span><span class="p">){</span>
        <span class="c1">// Handle event</span>
    <span class="p">})</span>
    <span class="o">-&gt;</span><span class="na">where</span><span class="p">(</span><span class="s1">&#39;bar&#39;</span><span class="p">,</span> <span class="s1">&#39;[a-zA-Z]+&#39;</span><span class="p">);</span>
    
    <span class="nv">$handler</span><span class="o">-&gt;</span><span class="na">handle</span><span class="p">(</span><span class="s1">&#39;{baz}&#39;</span><span class="p">,</span> <span class="k">function</span><span class="p">(</span><span class="nv">$event</span><span class="p">){</span>
        <span class="c1">// Handle event</span>
    <span class="p">})</span>
    <span class="o">-&gt;</span><span class="na">where</span><span class="p">(</span><span class="s1">&#39;baz&#39;</span><span class="p">,</span> <span class="s1">&#39;baz|qux&#39;</span><span class="p">);</span>

<span class="p">});</span>
</code></pre></div>

<p>
    Establishing the collecting priority for event handlers is done by passing an integer,
    as the second argument, to the <code>handle</code> method.
</p>

<div class="highlight"><pre><code class="php"><span class="k">use</span> <span class="nx">Opis\Colibri\Define</span><span class="p">;</span>

<span class="nx">Define</span><span class="o">::</span><span class="na">EventHandlers</span><span class="p">(</span><span class="k">function</span><span class="p">(</span><span class="nv">$handler</span><span class="p">){</span>

    <span class="nv">$handler</span><span class="o">-&gt;</span><span class="na">handle</span><span class="p">(</span><span class="s1">&#39;foo.bar&#39;</span><span class="p">,</span> <span class="k">function</span><span class="p">(</span><span class="nv">$event</span><span class="p">){</span>
        <span class="c1">// Handle event</span>
    <span class="p">},</span> <span class="mi">1</span><span class="p">);</span>

<span class="p">});</span>
</code></pre></div>


        


    


    


    

<h3>
    
    
    Triggering events
    
    <a id="triggering-events" href="#triggering-events" class="link-anchor"><span class="fa fa-link"></span></a>
</h3>

<p>
    The simplest way you could trigger an event is by using the <a href="functions.html">Emit</a> global function.
    The function takes as an argument the name of the event you want to trigger and returns the instance of the triggered
    event. The event triggered when using the <code>Emit</code> function is an instance of the <code>Opis\Colibri\Event</code> class.
    Optionally you can pass <code>true</code>, as the second argument to the function, if you want to make your event cancelable.
</p>

<div class="highlight"><pre><code class="php"><span class="c1">// Emit a `foo.bar` event</span>
<span class="nx">Emit</span><span class="p">(</span><span class="s1">&#39;foo.bar&#39;</span><span class="p">);</span>

<span class="c1">//Emit a cancelable `foo.bar` event</span>
<span class="nv">$event</span> <span class="o">=</span> <span class="nx">Emit</span><span class="p">(</span><span class="s1">&#39;foo.bar&#39;</span><span class="p">,</span> <span class="k">true</span><span class="p">);</span>

<span class="k">if</span><span class="p">(</span><span class="nv">$event</span><span class="o">-&gt;</span><span class="na">canceled</span><span class="p">())</span>
<span class="p">{</span>
    <span class="c1">//do something</span>
<span class="p">}</span>
</code></pre></div>

<p>
    You can trigger any type of events by using the <a href="functions.html">Dispatch</a> global function.
    The function takes as argument an object that inherits form the <code>Opis\Colibri\Event</code> class
    and returns the same object.
</p>

<div class="highlight"><pre><code class="php"><span class="c1">// Dispatch a FooEvent</span>
<span class="nx">Dispatch</span><span class="p">(</span><span class="k">new</span> <span class="nx">FooEvent</span><span class="p">());</span>
</code></pre></div>

<p>
    Events are not only a notice mechanism, they can also be used as an effective collecting mechanism.
    In fact, the whole collecting process of the framework is based on a custom version of events :)
</p>

<div class="highlight"><pre><code class="php"><span class="k">use</span> <span class="nx">Opis\Colibri\Define</span><span class="p">;</span>

<span class="nx">Define</span><span class="o">::</span><span class="na">EventHandlers</span><span class="p">(</span><span class="k">function</span><span class="p">(</span><span class="nv">$handler</span><span class="p">){</span>
    
    <span class="c1">// Intercept `foo` events</span>
    <span class="nv">$handler</span><span class="o">-&gt;</span><span class="na">handle</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="k">function</span><span class="p">(</span><span class="nv">$event</span><span class="p">){</span>
        <span class="nv">$event</span><span class="o">-&gt;</span><span class="na">collect</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">);</span>
    <span class="p">});</span>

<span class="p">});</span>
</code></pre></div>

<div class="highlight"><pre><code class="php"><span class="k">class</span> <span class="nc">FooEvent</span> <span class="k">extends</span> <span class="nx">\Opis\Colibri\Event</span>
<span class="p">{</span>
    <span class="k">protected</span> <span class="nv">$values</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>
    
    <span class="k">public</span> <span class="k">function</span> <span class="nf">__construct</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">parent</span><span class="o">::</span><span class="na">__construct</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">);</span>
    <span class="p">}</span>
    
    <span class="k">public</span> <span class="k">function</span> <span class="nf">collect</span><span class="p">(</span><span class="nv">$value</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">values</span><span class="p">[]</span> <span class="o">=</span> <span class="nv">$value</span><span class="p">;</span>
    <span class="p">}</span>
    
    <span class="k">public</span> <span class="k">function</span> <span class="nf">getCollectedValues</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">values</span><span class="p">;</span>
    <span class="p">}</span>
    
<span class="p">}</span>

<span class="nv">$values</span> <span class="o">=</span> <span class="nx">Dispatch</span><span class="p">(</span><span class="k">new</span> <span class="nx">FooEvent</span><span class="p">())</span><span class="o">-&gt;</span><span class="na">getCollectedValues</span><span class="p">();</span>
</code></pre></div>


        


    


    


    

<h3>
    
    
    Framework specific events
    
    <a id="framework-specific-events" href="#framework-specific-events" class="link-anchor"><span class="fa fa-link"></span></a>
</h3>

<p>
    One of the framework's specific event is the <code>system.init</code> event. This event
    is triggerd just once, after the framework is fully initalized.
</p>

<p>
    Another set of framework specific events is the module related events. The module related
    events are <code>module.installed.{module}</code>, <code>module.enabled.{module}</code>,
    <code>module.disabled.{module}</code> and <code>module.uninstalled.{module}</code>.
    These events are triggered when a module named <code>{module}</code> is installed, enabled, disabled or uninstalled.
</p>


            





    
        
            
                
            
        
    

    
        
            
                
            
        
    

    
        
            
                
            
        
    

    
        
            
                
            
        
    

    
        
            
                
            
        
    

    
        
            
                
            
        
    

    
        
            
                
            
        
    

    
        
            
                
            
        
    

    
        
            
                
            
        
    

    
        
            
                
            
        
    

    
        
            
                
            
        
    

    
        
            
                
            
        
    

    
        
            
                
            
        
    

    
        
            
                
            
        
    

    
        
            
        
    

    
        
            
                
                
            
        
    

    

    

    

    

    

    


<ul class="pager">
  
  <li class="previous"><a href="/colibri/documentation/contracts.html" title="Contracts">&larr; Back</a></li>
  
  
  <li class="next"><a href="/colibri/documentation/databases.html" title="Database connections">Next &rarr;</a></li>
  
</ul>
            
        </div>
    </div>
    <a href="#0" id="back-to-top">
        <span class="fa fa-arrow-up"></span>
    </a>
</div>
<script>
    (function($){
        
        $(document).ready(function(){
           var visible = false;
           $(window).scroll(function(){
                var top = $(this).scrollTop();
                
                if (top >= 100 && !visible) {
                   visible = true;
                   $('#back-to-top').fadeIn().show();
                 }
                 if(top < 100 && visible){
                   visible = false;
                   $('#back-to-top').fadeOut();  
                 }
           });
           
            $('#back-to-top').click(function(){
                $('html, body').animate({scrollTop : 0},800);
                return false;
            });
            
        });
        
        
    })(jQuery);
</script>
</section>

<footer class="text-center text-muted">
    Copyright &copy; 2014-2015 Marius Sarca. All rights reserved.
</footer>

    </body>
</html>
