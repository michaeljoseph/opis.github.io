<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="keywords" content="php, database, abstraction, query builder, schema builder">
<meta name="description" content="Learn how to use transactions">
<title>Transactions | Opis Database</title>
        
        <link href="/assets/img/favicon.png" rel="shortcut icon">
        
        
        
<link rel="stylesheet" href="/assets/css/flatly-theme.min.css">

<link href="/assets/css/font-awesome.css" rel="stylesheet">

<link href="/assets/css/syntax.css" rel="stylesheet">



<link href="/assets/css/project.css" rel="stylesheet">


        
        <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/github-fork-ribbon-css/0.1.1/gh-fork-ribbon.min.css" />
        <!--[if lt IE 9]>
        <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/github-fork-ribbon-css/0.1.1/gh-fork-ribbon.ie.min.css" />
        <![endif]--> 
        
        <!--[if lt IE 9]>
<script src="/assets/js/html5shiv.js"></script>
<script src="/assets/js/respond.min.js"></script>
<![endif]-->
<!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
<script src="/assets/js/jquery-1.11.0.min.js"></script>
<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="/assets/js/bootstrap.min.js"></script>


<script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  
    ga('create', 'UA-50415801-1', 'opis.io');
    ga('send', 'pageview');
</script>

    </head>
    <body>
        

<div class="github-fork-ribbon-wrapper right hidden-sm hidden-xs">
    <div class="github-fork-ribbon" style="background-color: #f80">
        <a href="https://github.com/opis/database">Fork me on GitHub</a>
    </div>
</div>

<header id="header" class="navbar navbar-default navbar-static-top">
    <div class="container">
        <div class="navbar-header">
            <img src="/assets/img/opis-gs-100.png" class="img-responsive opis-inline-logo">
            <a href="/database" class="navbar-brand">
                <strong>
                    Database
                </strong>
            </a>
            <button data-target="#navbar-main" data-toggle="collapse" type="button" class="navbar-toggle">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
        </div>
        <nav id="navbar-main" class="collapse navbar-collapse navbar-right">
            <ul class="nav navbar-nav">
                <li>
                    <a href="/" title="Main page">
                        <span class="fa fa-home"></span> Home
                    </a>
                </li>
                <li class="dropdown hidden-md hidden-lg">
    <a class="dropdown-toggle" data-toggle="dropdown" href="#">
        <span class="fa fa-file-text"></span> Documentation <span class="caret"></span>
    </a>
    <ul class="dropdown-menu">
    
        
        <li class="dropdown-header">Getting started</li>
        
        <li><a href="/database" title="Getting started with Opis Database">About</a></li>
    
        
        <li><a href="/database/connection.html" title="Learn how to connect to a database">Database connections</a></li>
    
        
        <li class="dropdown-header">The basics</li>
        
        <li><a href="/database/select.html" title="Fetching records from a database">Fetching records</a></li>
    
        
        <li><a href="/database/result.html" title="Learn how to handle the result set of a query">Results handling</a></li>
    
        
        <li><a href="/database/aggregate.html" title="Learn about aggregate functions">Aggregate functions</a></li>
    
        
        <li><a href="/database/extended-selections.html" title="Learn about how to define custom selections">Extended selections</a></li>
    
        
        <li><a href="/database/filter.html" title="Learn how to filter records">Filters</a></li>
    
        
        <li><a href="/database/expression.html" title="Learn about expressions">Expressions</a></li>
    
        
        <li><a href="/database/order.html" title="Learn how to order results">Ordering criteria</a></li>
    
        
        <li><a href="/database/limit.html" title="Learn about limits and offsets">Limits and offsets</a></li>
    
        
        <li><a href="/database/join.html" title="Learn how to perform joins">Joins</a></li>
    
        
        <li><a href="/database/aggregates-handling.html" title="Learn how to work with aggregates">Working with aggregates</a></li>
    
        
        <li><a href="/database/insert.html" title="Insert new records into a table">Create records</a></li>
    
        
        <li><a href="/database/update.html" title="Learn how to update existing records">Update records</a></li>
    
        
        <li><a href="/database/delete.html" title="Learn how to delete existing records">Delete records</a></li>
    
        
        <li class="dropdown-header">Transactions</li>
        
        <li class="active"><a href="/database/transaction.html" title="Learn how to use transactions">Performing transactions</a></li>
    
        
        <li class="dropdown-header">Database schema</li>
        
        <li><a href="/database/schema.html" title="Learn about Opis Database schema">Introduction</a></li>
    
        
        <li><a href="/database/creating-tables.html" title="Creating new tables">Creating tables</a></li>
    
        
        <li><a href="/database/modifying-tables.html" title="Modify existing tables">Modifying tables</a></li>
    
        
        <li class="dropdown-header">ORM</li>
        
        <li><a href="/database/orm.html" title="Learn about Opis Database ORM">Introduction</a></li>
    
        
        <li><a href="/database/orm-basics.html" title="Learn about ORM relationships">Basic operations</a></li>
    
        
        <li><a href="/database/orm-relationships.html" title="Learn about ORM relationships">Relationships</a></li>
    
        
        <li><a href="/database/orm-models.html" title="Learn about ORM relationships">Working with models</a></li>
    
    </ul>
</li>
                <li class="dropdown">
                    <a class="dropdown-toggle" data-toggle="dropdown" href="#">
                        <span class="fa fa-cogs"></span> Components <span class="caret"></span>
                    </a>
                    <ul class="dropdown-menu">
                        <li><a href="/cache" title="Caching library">Cache</a></li>
                        <li><a href="/closure" title="Serializable closures">Closure</a></li>
                        <li><a href="/config" title="Configuration manager">Config</a></li>
                        <li><a href="/container" title="Dependency injection container">Container</a></li>
                        <li><a href="/database" title="Database abstraction layer">Database</a></li>
                        <li><a href="/events" title="Events library">Events</a></li>
                        <li><a href="/http" title="HTTP library">HTTP</a></li>
                        <li><a href="/http-routing" title="HTTP routing library">HTTP Routing</a></li>
                        <li><a href="/routing" title="Routing framework">Routing</a></li>
                        <li><a href="/session" title="Session manager">Session</a></li>
                        <li><a href="/utils" title="Utilitary classes">Utils</a></li>
                        <li><a href="/view" title="Rendering engine">View</a></li>
                    </ul>
                </li>
                
    
    

                <li class="hidden-md hidden-lg">
                    <a href="https://github.com/opis/database" title="Github page">
                        <span class="fa fa-github fa-lg"></span> GitHub
                    </a>
                </li>
            </ul>
        </nav>
    </div>
</header>

<section>
    <div class="container">
        <div class="row">
            <div class="col-md-4 hidden-xs hidden-sm">
                
                    
<ul class="navigation">

    
        
            
        
        <li class="chapter">Getting started</li>
        <ul>
            <li><a href="/database" title="Getting started with Opis Database">About</a></li>
    

    
        <li><a href="/database/connection.html" title="Learn how to connect to a database">Database connections</a></li>
    

    
        
        </ul>
        
        <li class="chapter">The basics</li>
        <ul>
            <li><a href="/database/select.html" title="Fetching records from a database">Fetching records</a></li>
    

    
        <li><a href="/database/result.html" title="Learn how to handle the result set of a query">Results handling</a></li>
    

    
        <li><a href="/database/aggregate.html" title="Learn about aggregate functions">Aggregate functions</a></li>
    

    
        <li><a href="/database/extended-selections.html" title="Learn about how to define custom selections">Extended selections</a></li>
    

    
        <li><a href="/database/filter.html" title="Learn how to filter records">Filters</a></li>
    

    
        <li><a href="/database/expression.html" title="Learn about expressions">Expressions</a></li>
    

    
        <li><a href="/database/order.html" title="Learn how to order results">Ordering criteria</a></li>
    

    
        <li><a href="/database/limit.html" title="Learn about limits and offsets">Limits and offsets</a></li>
    

    
        <li><a href="/database/join.html" title="Learn how to perform joins">Joins</a></li>
    

    
        <li><a href="/database/aggregates-handling.html" title="Learn how to work with aggregates">Working with aggregates</a></li>
    

    
        <li><a href="/database/insert.html" title="Insert new records into a table">Create records</a></li>
    

    
        <li><a href="/database/update.html" title="Learn how to update existing records">Update records</a></li>
    

    
        <li><a href="/database/delete.html" title="Learn how to delete existing records">Delete records</a></li>
    

    
        
        </ul>
        
        <li class="chapter">Transactions</li>
        <ul>
            <li class="active"><a href="/database/transaction.html" title="Learn how to use transactions">Performing transactions</a></li>
    

    
        
        </ul>
        
        <li class="chapter">Database schema</li>
        <ul>
            <li><a href="/database/schema.html" title="Learn about Opis Database schema">Introduction</a></li>
    

    
        <li><a href="/database/creating-tables.html" title="Creating new tables">Creating tables</a></li>
    

    
        <li><a href="/database/modifying-tables.html" title="Modify existing tables">Modifying tables</a></li>
    

    
        
        </ul>
        
        <li class="chapter">ORM</li>
        <ul>
            <li><a href="/database/orm.html" title="Learn about Opis Database ORM">Introduction</a></li>
    

    
        <li><a href="/database/orm-basics.html" title="Learn about ORM relationships">Basic operations</a></li>
    

    
        <li><a href="/database/orm-relationships.html" title="Learn about ORM relationships">Relationships</a></li>
    

    
        <li><a href="/database/orm-models.html" title="Learn about ORM relationships">Working with models</a></li>
    

    </ul>
</ul>

                
            </div>
            <div class="col-md-8 col-sm-12">
                
        


        

<h1>
    
    <strong>Transactions</strong>
    
</h1>


<ol class="submenu">
    <li>




    

<a href="#performing-transactions">Performing transactions</a></li>
    <li>




    

<a href="#receiving-notifications">Receiving notifications</a></li>
    <li>




    

<a href="#controlling-transaction-s-flow">Controlling transaction's flow</a></li>
</ol>


        


    


        


    

<h3>
    
    
    <strong>Performing transactions</strong>
    
    <a id="performing-transactions" href="#performing-transactions" class="link-anchor"><span class="fa fa-link"></span></a>
</h3>

<p>
    Transactions are performed with the help of the <code>transaction</code> and <code>execute</code> methods.
    The result returned from a transaction wiil be the result returned from the anonymous callback function that was
    passed as an argument to the <code>transaction</code> method.
</p>

<div class="highlight"><pre><code class="php"><span class="k">use</span> <span class="nx">Opis\Database\Database</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Opis\Database\Connection</span><span class="p">;</span>

<span class="nv">$connection</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Connection</span><span class="p">(</span><span class="s1">&#39;mysql:host=localhost;dbname=test&#39;</span><span class="p">,</span> <span class="s1">&#39;username&#39;</span><span class="p">,</span> <span class="s1">&#39;password&#39;</span><span class="p">);</span>
<span class="nv">$db</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Database</span><span class="p">(</span><span class="nv">$connection</span><span class="p">);</span>

<span class="nv">$result</span> <span class="o">=</span> <span class="nv">$db</span><span class="o">-&gt;</span><span class="na">transaction</span><span class="p">(</span><span class="k">function</span><span class="p">(</span><span class="nx">Database</span> <span class="nv">$db</span><span class="p">){</span>
    
    <span class="nv">$db</span><span class="o">-&gt;</span><span class="na">insert</span><span class="p">([</span><span class="s1">&#39;user&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;John Doe&#39;</span><span class="p">,</span> <span class="s1">&#39;email&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;jd@foobar.com&#39;</span><span class="p">])</span>
       <span class="o">-&gt;</span><span class="na">into</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">);</span>
       
    <span class="k">return</span> <span class="nv">$db</span><span class="o">-&gt;</span><span class="na">getConnection</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">pdo</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">lastInsertId</span><span class="p">();</span>
<span class="p">})</span>
<span class="o">-&gt;</span><span class="na">execute</span><span class="p">();</span>
</code></pre></div>


        


    


        


    

<h3>
    
    
    <strong>Receiving notifications</strong>
    
    <a id="receiving-notifications" href="#receiving-notifications" class="link-anchor"><span class="fa fa-link"></span></a>
</h3>

<p>
    You can receive notifications about transaction errors by using the <code>onError</code> method. The method accepts as an argument
    an anonymous function which will be called if an error occurs. The arguments passed to the callback function are the
    current instance of the <code>Opis\Database\Transaction</code> class and the instance of the <code>PDOException</code> class
    that was thrown as an exception.
</p>

<div class="highlight"><pre><code class="php"><span class="k">use</span> <span class="nx">PDOException</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Opis\Database\Transaction</span><span class="p">;</span>

<span class="c1">// ...</span>

<span class="nv">$result</span> <span class="o">=</span> <span class="nv">$db</span><span class="o">-&gt;</span><span class="na">transaction</span><span class="p">(</span><span class="k">function</span><span class="p">(</span><span class="nx">Database</span> <span class="nv">$db</span><span class="p">){</span>
    
    <span class="nv">$db</span><span class="o">-&gt;</span><span class="na">insert</span><span class="p">([</span><span class="s1">&#39;user&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;John Doe&#39;</span><span class="p">,</span> <span class="s1">&#39;email&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;jd@foobar.com&#39;</span><span class="p">])</span>
       <span class="o">-&gt;</span><span class="na">into</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">);</span>
       
    <span class="k">return</span> <span class="nv">$db</span><span class="o">-&gt;</span><span class="na">getConnection</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">pdo</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">lastInsertId</span><span class="p">();</span>
<span class="p">})</span>
<span class="o">-&gt;</span><span class="na">onError</span><span class="p">(</span><span class="k">function</span><span class="p">(</span><span class="nx">PDOException</span> <span class="nv">$exception</span><span class="p">,</span> <span class="nx">Transaction</span> <span class="nv">$transaction</span><span class="p">){</span>
    <span class="c1">// code here</span>
<span class="p">})</span>
<span class="o">-&gt;</span><span class="na">execute</span><span class="p">();</span>
</code></pre></div>

<p>
    Receiving notifications about successful transaction is done by using the <code>onSuccess</code> method.
    The method accepts as an argument an anonymous callback function that will be called if the transaction succeeds.
    The arguments passed to the callback function is the current instance of the <code>Opis\Database\Transaction</code> class.
</p>

<div class="highlight"><pre><code class="php"><span class="k">use</span> <span class="nx">PDOException</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Opis\Database\Transaction</span><span class="p">;</span>

<span class="c1">// ...</span>

<span class="nv">$result</span> <span class="o">=</span> <span class="nv">$db</span><span class="o">-&gt;</span><span class="na">transaction</span><span class="p">(</span><span class="k">function</span><span class="p">(</span><span class="nx">Database</span> <span class="nv">$db</span><span class="p">){</span>
    
    <span class="nv">$db</span><span class="o">-&gt;</span><span class="na">insert</span><span class="p">([</span><span class="s1">&#39;user&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;John Doe&#39;</span><span class="p">,</span> <span class="s1">&#39;email&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;jd@foobar.com&#39;</span><span class="p">])</span>
       <span class="o">-&gt;</span><span class="na">into</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">);</span>
       
    <span class="k">return</span> <span class="nv">$db</span><span class="o">-&gt;</span><span class="na">getConnection</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">pdo</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">lastInsertId</span><span class="p">();</span>
<span class="p">})</span>
<span class="o">-&gt;</span><span class="na">onSuccess</span><span class="p">(</span><span class="k">function</span><span class="p">(</span><span class="nx">Transaction</span> <span class="nv">$transaction</span><span class="p">){</span>
    <span class="c1">// code here</span>
<span class="p">})</span>
<span class="o">-&gt;</span><span class="na">execute</span><span class="p">();</span>
</code></pre></div>


        


    


        


    

<h3>
    
    
    <strong>Controlling transaction's flow</strong>
    
    <a id="controlling-transaction-s-flow" href="#controlling-transaction-s-flow" class="link-anchor"><span class="fa fa-link"></span></a>
</h3>

<p>
    You can control in slight details how a transaction will be executed by passing
    an anonymous function as an argument to the <code>execute</code> method.
    The anonymous function will receive as an argument the current instance of the <code>Opis\Database\Transaction</code>
    and the closure that was passed to the <code>transaction</code> method.
</p>

<div class="highlight"><pre><code class="php"><span class="k">use</span> <span class="nx">Closure</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Opis\Database\Transaction</span><span class="p">;</span>

<span class="c1">// ...</span>

<span class="nv">$result</span> <span class="o">=</span> <span class="nv">$db</span><span class="o">-&gt;</span><span class="na">transaction</span><span class="p">(</span><span class="k">function</span><span class="p">(</span><span class="nx">Database</span> <span class="nv">$db</span><span class="p">){</span>
    
    <span class="nv">$db</span><span class="o">-&gt;</span><span class="na">insert</span><span class="p">([</span><span class="s1">&#39;user&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;John Doe&#39;</span><span class="p">,</span> <span class="s1">&#39;email&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;jd@foobar.com&#39;</span><span class="p">])</span>
       <span class="o">-&gt;</span><span class="na">into</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">);</span>
       
    <span class="k">return</span> <span class="nv">$db</span><span class="o">-&gt;</span><span class="na">getConnection</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">pdo</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">lastInsertId</span><span class="p">();</span>
<span class="p">})</span>
<span class="o">-&gt;</span><span class="na">execute</span><span class="p">(</span><span class="k">function</span><span class="p">(</span><span class="nx">Transaction</span> <span class="nv">$transaction</span><span class="p">,</span> <span class="nx">Closure</span> <span class="nv">$callback</span><span class="p">){</span>
    <span class="c1">// ...</span>
<span class="p">});</span>
</code></pre></div>

<p>
    The <code>Opis\Database\Transaction</code> class offers a series of method that can be used to control how a transaction will be performed.
</p>

<p>
    Starting a transaction is done by using the <code>begin</code> method. Committing a transaction is done by using the
    <code>commit</code> method, and rolling back a transaction is done by using the <code>rollBack</code> method.
</p>
<p>
    You can obtain the instance of <code>Opis\Database\Database</code> class used for the ongoing transaction
    by calling the <code>database</code> method. You also have access to the underlying <code>PDO</code> object
    by calling the <code>pdo</code> method.
</p>

<div class="highlight"><pre><code class="php"><span class="k">use</span> <span class="nx">Closure</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">PDOException</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Opis\Database\Transaction</span><span class="p">;</span>

<span class="c1">// ...</span>

<span class="nv">$result</span> <span class="o">=</span> <span class="nv">$db</span><span class="o">-&gt;</span><span class="na">transaction</span><span class="p">(</span><span class="k">function</span><span class="p">(</span><span class="nx">Database</span> <span class="nv">$db</span><span class="p">){</span>
    
    <span class="nv">$db</span><span class="o">-&gt;</span><span class="na">insert</span><span class="p">([</span><span class="s1">&#39;user&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;John Doe&#39;</span><span class="p">,</span> <span class="s1">&#39;email&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;jd@foobar.com&#39;</span><span class="p">])</span>
       <span class="o">-&gt;</span><span class="na">into</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">);</span>
       
    <span class="k">return</span> <span class="nv">$db</span><span class="o">-&gt;</span><span class="na">getConnection</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">pdo</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">lastInsertId</span><span class="p">();</span>
<span class="p">})</span>
<span class="o">-&gt;</span><span class="na">execute</span><span class="p">(</span><span class="k">function</span><span class="p">(</span><span class="nx">Transaction</span> <span class="nv">$transaction</span><span class="p">,</span> <span class="nx">Closure</span> <span class="nv">$callback</span><span class="p">){</span>
    
    <span class="k">try</span>
    <span class="p">{</span>
        <span class="c1">// Begin the transaction</span>
        <span class="nv">$transaction</span><span class="o">-&gt;</span><span class="na">begin</span><span class="p">();</span>
        <span class="c1">// Execute the callback</span>
        <span class="nv">$result</span> <span class="o">=</span> <span class="nv">$callback</span><span class="p">(</span><span class="nv">$transaction</span><span class="o">-&gt;</span><span class="na">database</span><span class="p">());</span>
        <span class="c1">// Commit the transaction</span>
        <span class="nv">$transaction</span><span class="o">-&gt;</span><span class="na">commit</span><span class="p">();</span>
        <span class="c1">// Return the result of the transaction</span>
        <span class="k">return</span> <span class="nv">$result</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">catch</span><span class="p">(</span><span class="nx">PDOException</span> <span class="nv">$e</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// Rollback the transaction</span>
        <span class="nv">$transaction</span><span class="o">-&gt;</span><span class="na">rollBack</span><span class="p">();</span>
    <span class="p">}</span>
    
<span class="p">});</span>
</code></pre></div>

<p>
    You can get the success and error callbacks by using the <code>getOnSuccessCallback</code> and
    <code>getOnErrorCallback</code> methods.
</p>

<div class="highlight"><pre><code class="php"><span class="k">use</span> <span class="nx">Closure</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">PDOException</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Opis\Database\Transaction</span><span class="p">;</span>

<span class="c1">// ...</span>

<span class="nv">$result</span> <span class="o">=</span> <span class="nv">$db</span><span class="o">-&gt;</span><span class="na">transaction</span><span class="p">(</span><span class="k">function</span><span class="p">(</span><span class="nx">Database</span> <span class="nv">$db</span><span class="p">){</span>
    
    <span class="nv">$db</span><span class="o">-&gt;</span><span class="na">insert</span><span class="p">([</span><span class="s1">&#39;user&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;John Doe&#39;</span><span class="p">,</span> <span class="s1">&#39;email&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;jd@foobar.com&#39;</span><span class="p">])</span>
       <span class="o">-&gt;</span><span class="na">into</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">);</span>
       
    <span class="k">return</span> <span class="nv">$db</span><span class="o">-&gt;</span><span class="na">getConnection</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">pdo</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">lastInsertId</span><span class="p">();</span>
<span class="p">})</span>
<span class="o">-&gt;</span><span class="na">execute</span><span class="p">(</span><span class="k">function</span><span class="p">(</span><span class="nx">Transaction</span> <span class="nv">$transaction</span><span class="p">,</span> <span class="nx">Closure</span> <span class="nv">$callback</span><span class="p">){</span>
    
    <span class="k">try</span>
    <span class="p">{</span>
        <span class="c1">// Begin the transaction</span>
        <span class="nv">$transaction</span><span class="o">-&gt;</span><span class="na">begin</span><span class="p">();</span>
        <span class="c1">// Execute the callback</span>
        <span class="nv">$result</span> <span class="o">=</span> <span class="nv">$callback</span><span class="p">(</span><span class="nv">$transaction</span><span class="o">-&gt;</span><span class="na">database</span><span class="p">());</span>
        <span class="c1">// Commit the transaction</span>
        <span class="nv">$transaction</span><span class="o">-&gt;</span><span class="na">commit</span><span class="p">();</span>
        <span class="c1">// Get the success callback</span>
        <span class="k">if</span><span class="p">(</span><span class="k">null</span> <span class="o">!==</span> <span class="nv">$success</span> <span class="o">=</span> <span class="nv">$transaction</span><span class="o">-&gt;</span><span class="na">getOnSuccessCallback</span><span class="p">())</span>
        <span class="p">{</span>
            <span class="nv">$success</span><span class="p">(</span><span class="nv">$transaction</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="c1">// Return the result of the transaction</span>
        <span class="k">return</span> <span class="nv">$result</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">catch</span><span class="p">(</span><span class="nx">PDOException</span> <span class="nv">$e</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// Rollback the transaction</span>
        <span class="nv">$transaction</span><span class="o">-&gt;</span><span class="na">rollBack</span><span class="p">();</span>
        <span class="c1">// Get the error callback</span>
        <span class="k">if</span><span class="p">(</span><span class="k">null</span> <span class="o">!==</span> <span class="nv">$error</span> <span class="o">=</span> <span class="nv">$transaction</span><span class="o">-&gt;</span><span class="na">getOnErrorCallback</span><span class="p">())</span>
        <span class="p">{</span>
            <span class="nv">$error</span><span class="p">(</span><span class="nv">$e</span><span class="p">,</span> <span class="nv">$transaction</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
    
<span class="p">});</span>
</code></pre></div>


                





    
        
            
                
            
        
    

    
        
            
                
            
        
    

    
        
            
                
            
        
    

    
        
            
                
            
        
    

    
        
            
                
            
        
    

    
        
            
                
            
        
    

    
        
            
                
            
        
    

    
        
            
                
            
        
    

    
        
            
                
            
        
    

    
        
            
                
            
        
    

    
        
            
                
            
        
    

    
        
            
                
            
        
    

    
        
            
                
            
        
    

    
        
            
                
            
        
    

    
        
            
                
            
        
    

    
        
            
        
    

    
        
            
                
                
            
        
    

    

    

    

    

    

    


<ul class="pager">
  
  <li class="previous"><a href="/database/delete.html" title="Delete records">&larr; Back</a></li>
  
  
  <li class="next"><a href="/database/schema.html" title="Introduction">Next &rarr;</a></li>
  
</ul>
                
            </div>
        </div>
    </div>
</section>
<a href="#0" id="back-to-top">
    <span class="fa fa-arrow-up"></span>
</a>
<script>
    (function($){
        
        $(document).ready(function(){
           var visible = false;
           $(window).scroll(function(){
                var top = $(this).scrollTop();
                
                if (top >= 100 && !visible) {
                   visible = true;
                   $('#back-to-top').fadeIn().show();
                 }
                 if(top < 100 && visible){
                   visible = false;
                   $('#back-to-top').fadeOut();  
                 }
           });
           
            $('#back-to-top').click(function(){
                $('html, body').animate({scrollTop : 0},800);
                return false;
            });
            
        });
        
        
    })(jQuery);
</script>
<footer class="text-center text-muted">
    Copyright &copy; 2014-2015 Marius Sarca. All rights reserved.
</footer>

    </body>
</html>
